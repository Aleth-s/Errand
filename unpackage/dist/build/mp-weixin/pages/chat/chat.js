(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/chat"],{"16f1":function(t,e,o){},"1ba2":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},i=[]},"53dd":function(t,e,o){"use strict";o.r(e);var n=o("d3e7"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},8354:function(t,e,o){"use strict";var n=o("16f1"),i=o.n(n);i.a},9607:function(t,e,o){"use strict";o.r(e);var n=o("1ba2"),i=o("53dd");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("8354");var c=o("828b"),a=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"7780334e",null,!1,n["a"],void 0);e["default"]=a.exports},d3e7:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{newChatList:[],adminId:4,user:t.getStorageSync("xm-user"),chatGroupList:[],activeChatUserId:4,form:{},chatList:[],keyboardHeight:0,bottomHeight:0,scrollTop:0,userId:"",chatMsg:"",msgList:[{botContent:"你好啊，很高兴你可以关注我，请问我有什么可以帮助你的吗？",userContent:"",image:"/static/common/unname1.jpeg"},{botContent:"",userContent:"你好呀，非常高兴认识你",image:"/static/common/unname2.jpg"}]}},updated:function(){this.scrollToBottom()},computed:{windowHeight:function(){return this.rpxTopx(t.getSystemInfoSync().windowHeight)},inputHeight:function(){return this.bottomHeight+this.keyboardHeight}},onLoad:function(){var e=this,o=this;this.chat(this.adminId),this.loadChatGroup(),this.loadChatList(this.activeChatUserId),t.onKeyboardHeightChange((function(t){e.keyboardHeight=e.rpxTopx(t.height),e.keyboardHeight<0&&(e.keyboardHeight=0)})),t.connectSocket({url:"ws://localhost:9090/chatServer/1",success:function(){console.log("WebSocket连接成功")},fail:function(t){console.error("WebSocket连接失败",t)}}),t.onSocketOpen((function(){console.log("WebSocket连接已打开")})),t.onSocketMessage((function(t){o.loadChatGroup(),o.loadChatList(o.activeChatUserId),console.log("收到消息：",t.data)})),t.onSocketError((function(t){console.error("WebSocket错误：",t)})),t.onSocketClose((function(t){console.log("WebSocket 已关闭！")}))},methods:{refresh:function(){var e=this;t.showToast({icon:"yes",title:"刷新成功"}),this.$request.get("/chatInfo/selectUserChat/"+this.activeChatUserId).then((function(t){e.chatList=t.data||[],e.scrollToBottom()}))},exit:function(){t.closeSocket({success:function(){console.log("WebSocket 已关闭")},fail:function(t){console.error("关闭 WebSocket 连接失败",t)}}),t.switchTab({url:"/pages/personal/personal"})},chat:function(t){this.$request.post("/chatGroup/add",{chatUserId:t,userId:this.user.id}).then((function(t){}))},loadChatGroup:function(){var t=this;this.$request.get("/chatGroup/selectUserGroup").then((function(e){t.chatGroupList=e.data||[]}))},loadChatList:function(t){var e=this;this.form={},this.activeChatUserId=t,this.$request.put("/chatInfo/updateRead/"+t).then((function(t){e.loadChatGroup()})),this.$request.get("/chatInfo/selectUserChat/"+t).then((function(t){e.chatList=t.data||[]}))},focus:function(){this.scrollToBottom()},blur:function(){this.scrollToBottom()},rpxTopx:function(e){var o=t.getSystemInfoSync().windowWidth,n=750/o*Number(e);return Math.floor(n)},sendHeight:function(){var e=this;setTimeout((function(){var o=t.createSelectorQuery();o.select(".send-msg").boundingClientRect(),o.exec((function(t){e.bottomHeight=e.rpxTopx(t[0].height)}))}),10)},scrollToBottom:function(e){var o=this;setTimeout((function(){var e=t.createSelectorQuery().in(o);e.select("#scrollview").boundingClientRect(),e.select("#msglistview").boundingClientRect(),e.exec((function(t){t[1].height>t[0].height&&(o.scrollTop=o.rpxTopx(t[1].height-t[0].height))}))}),15)},handleSend:function(){var e=this;if(this.form.chatUserId=this.activeChatUserId,this.form.userId=this.user.id,this.form.text=this.chatMsg,this.$request.post("/chatInfo/add",this.form).then((function(o){e.form={},e.loadChatList(e.activeChatUserId),t.sendSocketMessage({data:e.chatMsg,success:function(){console.log("消息发送成功")},fail:function(t){console.error("消息发送失败",t)}})})),this.chatMsg&&/^\s+$/.test(this.chatMsg))this.$modal.showToast("不能发送空白消息");else{var o={botContent:"",userContent:this.chatMsg,image:"/static/common/unname2.jpg"};this.msgList.push(o),this.chatMsg="",this.scrollToBottom()}}}};e.default=o}).call(this,o("df3c")["default"])},d405:function(t,e,o){"use strict";(function(t,e){var n=o("47a9");o("20fd");n(o("3240"));var i=n(o("9607"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])}},[["d405","common/runtime","common/vendor"]]]);